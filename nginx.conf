server {
    listen 80;
    server_name localhost;  # Change as needed

    # Serve Angular application
    location / {
        root /var/www/angular/dist;  # Path to your Angular build output
        try_files $uri $uri/ /index.html;  # Fallback to index.html for SPA routing
    }

    # Serve Symfony API
    location /api {
        alias /var/www/symfony/public;  # Path to your Symfony public directory
        try_files $uri @rewriteapp;  # Handle API requests
    }

    location @rewriteapp {
        rewrite ^/api/(.*)$ /api/index.php/$1 last;  # Rewrite requests to Symfony's index.php
    }

    # PHP handling for Symfony
    location ~ ^/api/index.php(/|$) {
        include fastcgi_params;
        fastcgi_pass php-fpm:9000;  # PHP-FPM service name
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  # Path to the PHP script
        fastcgi_param PATH_INFO $fastcgi_path_info;  # Pass path info
        fastcgi_param HTTPS off;  # Set to 'on' if using HTTPS
        client_max_body_size 200M;  # Max upload size
        fastcgi_read_timeout 600;  # Adjust as needed
    }

    # Static file handling for Symfony
    location ~ \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 30d;  # Cache static files for 30 days
        access_log off;  # Don't log static file access
    }

    # Log files
    error_log /var/log/nginx/symfony_error.log;
    access_log /var/log/nginx/symfony_access.log;
}
