
# start docker server with loading the file docker-compose.yml

docker-compose -f docker-compose.yml build
docker-compose -f docker-compose.yml up

# start docker in detached mode
docker-compose -f docker-compose.yml up -d

#build and run the docker
docker-compose -f docker-compose.yml up --build

# execute commands inside docker container
docker-compose exec symfony bash

php bin/console doctrine:database:create

// ngixt certificate
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout nginx.key -out nginx.crt


// Apache certifcate
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr
openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt


mkcert -key-file ssl/server.key -cert-file ssl/server.crt iba.local-backend localhost 127.0.0.1 ::1
mkcert -key-file ssl/server.key -cert-file ssl/server.crt iba.local-frontend localhost 127.0.0.1 ::1


FRONTEND:
// start frontend in dev mode
docker-compose -f docker-compose-dev.yml up --build

// build frontend
// ddev exec npm run build

BACKEND:
// start backend in dev mode in iba-app/backend directory
ddev restart

//
docker compose run node npm i && docker compose up
docker compose run node npm i && docker compose run node npm i && docker-compose -f docker-compose.yml up --build



ddev exec php bin/console doctrine:database:drop --force
ddev exec php bin/console doctrine:database:create
ddev exec php bin/console doctrine:migrations:diff
ddev exec php bin/console doctrine:migrations:migrate


angular:
nvm install 18.19.0
nvm use 18.19.0


// Production mode
docker-compose -f docker-compose-prod.yml up --build

// execute command in shell
docker exec -it zm32-symfony-1 sh
docker exec -it zm32-angular-1 sh

// troubleshouting

docker-compose ps
docker-compose logs symfony

// Restart only symfony without rebuilding
docker-compose -f docker-compose-prod.yml restart symfony


// kill angular ng serve
ps aux | grep ng

Example:
 ps aux | grep ng
node          18  0.0  0.0   2576   896 ?        S    10:51   0:00 sh -c ng serve --host 0.0.0.0 --port 4200
node          19 10.5  3.0 34514408 481540 ?     Sl   10:51   0:29 ng serve --host 0.0.0.0 --port 4200
node          30  0.3  0.1 724452 24436 ?        Sl   10:52   0:00 /app/node_modules/@esbuild/linux-x64/bin/esbuild --service=0.21.3 --ping
node          60  0.0  0.0   3324  1512 pts/0    S+   10:56   0:00 grep ng

kill -9 18 19 30 60


// rebuild only ngindx service
docker-compose -f docker-compose-prod.yml up --build nginx


 docker-compose exec php-fpm sh
 cd /usr/local/etc/php-fpm.d/
 vi www.conf

 access.log = /var/log/php-fpm.access.log
 slowlog = /var/log/php-fpm.slow.log
